# 요구사항 명세 및 설계 원칙

---

## 1. 기능적 요구사항 (Functional Requirements)

### < Happy Path >

- 사용자는 로그인한 상태에서만 브랜드, 상품 목록/상세, 좋아요, 주문, 결제, 포인트 충전 등 모든 기능을 사용할 수 있다.

- 사용자는 좋아요한 상품 중 여러 개를 선택해 주문할 수 있다.

- 주문 생성 시, 주문서에 상품 정보(이름, 가격, 수량 등)를 스냅샷으로 저장한다.

- 사용자는 자신의 포인트로만 주문 전체 금액을 결제할 수 있다.

- 결제 성공 시, 각 주문상품의 재고가 차감된다.

- 재고 차감까지 모두 성공하면 주문이 확정되고, 포인트 차감 및 포인트 내역이 기록된다.

- 사용자는 필요시 포인트를 충전할 수 있다.


---

### < Constraints >

- 모든 기능은 로그인한 사용자만 이용할 수 있다.

- 주문은 반드시 “판매중”인 상품에 대해서만 가능하다.

- 주문상품별 수량은 1~10개로 제한한다.

- 포인트 잔액이 결제 금액 이상이어야 한다.

- 결제는 포인트로만 가능하며, 일부/복합 결제는 불가하다.

- 결제 성공 시 재고를 차감한다. 결제 후 재고 부족 시 결제 취소(환불) 및 안내를 한다.

- 한정/선점 상품 등 특수 케이스는 추후 별도 정책(재고 락+타임아웃 등)으로 확장 가능. [옵셔널, 확장시]


---

### < Fail Cases >

→ 아래 조건 중 하나라도 만족하지 않으면 “오류를 반환한다”.

- 상품이 존재하지 않으면 오류 (404 NOT FOUND)

- 상품이 판매중 상태가 아니면 오류 (409 CONFLICT)

- 주문상품의 수량이 10개를 초과하면 오류 (400 BAD REQUEST)

- 포인트 잔액이 부족하면 오류 (400 BAD REQUEST)

- 결제/재고 차감 중 예외(DB, 네트워크 등) 발생 시 오류 (500 INTERNAL SERVER ERROR)

- 결제 성공 후 재고 차감 실패(재고 부족) 시, 결제를 취소(환불)하고 오류 안내 (409 CONFLICT)

- 로그인하지 않은 사용자는 인증 오류 (401 UNAUTHORIZED)


---

## 2. 비기능/정책 요구사항 (Non-Functional Requirements)

- 사용자 인증은 `X-USER-ID` Header 기반으로 처리한다.

- 주문/결제/재고 차감은 2초 이내에 완료되어야 한다. (초과 시 오류)

- 오류 상황에서는 명확한 HTTP 상태코드와 에러 메시지를 반환한다.

- 동시 주문/결제 요청이 들어와도 재고 및 포인트 차감이 정확히 처리되어야 한다.



|케이스|설명|HTTP 상태코드|
|---|---|---|
|상품 미존재|잘못된 productId|404 NOT FOUND|
|미로그인|인증 헤더 없음/유저 없음|401 UNAUTHORIZED|
|상품 판매중 아님|일시품절, 판매중단 등|409 CONFLICT|
|수량 초과|비즈니스 룰(최대 10개) 위반|400 BAD REQUEST|
|포인트 부족|결제 금액 초과 요청|400 BAD REQUEST|
|결제/재고 차감 실패|DB, 결제, 재고 등 예외, 네트워크 장애 등|500 INTERNAL SERVER ERROR|
|결제 후 재고 부족|결제 성공 후 재고 부족 → 결제 취소, 안내|409 CONFLICT|

---

## 3. 설계 원칙

- **외부 진입점(컨트롤러, API 등에서 호출되는 비즈니스 로직)은 반드시 `~Facade` 네이밍을 사용한다.**

    - 예: `OrderLikedProductsFacade`, `PayWithPointFacade`

- **파사드는 단일 진입점으로, 내부적으로 여러 서비스를 조합하여 비즈니스 플로우를 처리한다.**

- **간단한 액션도 일관성을 위해 파사드 네이밍을 사용한다. 복잡한 비즈니스 프로세스나 여러 서비스가 결합되는 경우에도 동일하게 파사드로 관리한다.**

- **내부적으로 도메인 서비스, 리포지토리 등은 각 역할에 맞는 네이밍을 사용한다.**

- **서비스(Service) 계층에서는 if/for문이나 프라이빗 메서드 사용을 최소화하고, 비즈니스 로직과 분기/반복은 도메인 객체(엔티티, 밸류, 도메인 서비스)로 위임한다.**

- **Value Object(VO)는 생성 시 자기 검증(유효성 검사)을 수행하여, 항상 일관되고 유효한 값만을 가진다.**

- **주문/결제/재고 처리 플로우는 “결제 성공 후 재고 차감, 재고 부족 시 환불”을 기본 정책으로 한다.**

- **특수 상품(한정, 선점 등)은 재고 락+타임아웃 등 별도 정책을 적용할 수 있도록 확장성을 고려한다.** [옵셔널, 확장시]

- **이러한 구조를 통해 일관성, 명확한 책임 분리, 유지보수의 용이성을 추구한다.**


---

## 4. 유비쿼터스 랭귀지(Ubiquitous Language) 정의

이 프로젝트에서는 아래 용어를 **도메인, 코드, 문서, 대화** 전반에 걸쳐 일관되게 사용한다.

- **User(사용자):** 브랜드 상품을 조회, 좋아요, 주문, 결제, 포인트 충전 등 모든 기능을 이용하는 시스템의 주체

- **Brand(브랜드):** 상품을 보유한 회사 또는 상표

- **Product(상품):** 브랜드가 제공하는 개별 판매 품목

- **ProductStock(상품재고):** 상품(Product)의 현재 보유 수량 [옵셔널, 확장시]

- **ProductOption(상품옵션):** 상품의 선택 가능한 속성(예: 색상, 사이즈 등) [옵셔널, 확장시]

- **ProductLike(상품좋아요):** 사용자가 특정 상품에 호감을 표시하는 행위 및 그 기록

- **Order(주문):** 사용자가 상품을 구매하겠다고 신청한 거래 단위

- **OrderItem(주문상품):** 주문에 포함된 개별 상품과 그 옵션, 수량, 가격 등의 정보

- **Payment(결제):** 주문에 대한 금전적 대가를 포인트로 지급하는 행위 및 그 기록

- **UserPoint(사용자포인트):** 사용자가 보유하거나 충전할 수 있는 결제 수단

- **PointHistory(포인트 내역):** 포인트의 충전, 차감 등 변동 내역을 기록하는 엔티티

- **Snapshot(스냅샷):** 주문 시점의 상품명, 가격, 옵션, 수량 등 변동 가능한 정보를 기록해 두는 방식

- **Facade(파사드):** 외부에서 비즈니스 플로우를 요청할 때 사용하는 단일 진입점 역할의 클래스/컴포넌트

- **Service(서비스):** 도메인 로직 또는 외부 연동 등 특정 역할을 담당하는 계층

- **Value Object(VO, 값 객체):** 불변성과 자기 검증을 가진, 도메인 내 의미 있는 값 단위


- **확장** **포인트**: 
  - Cart(장바구니)
  - ProductOption(상품옵션), ProductStock(상품재고)  
    → 추후 옵션/재고 관리가 필요할 때 도입 예정

  
- “좋아요”와 관련하여 확장성을 고려해

  상품, 브랜드 등 각 도메인별로 좋아요 엔티티를 별도로 설계함으로써 도메인의 성장/확장에 유연하게 대응한다.


  이 용어들은 설계, 개발, 문서, 커뮤니케이션 전반에서 혼동 없이 일관성 있게 사용한다.